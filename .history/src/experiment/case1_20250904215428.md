# 案例1：智能人脸识别打卡机

## 1. 项目简介

本项目旨在利用昇腾310B的强大AI算力，构建一个功能完整、响应迅速的智能人脸识别打卡系统。系统通过USB摄像头实时捕捉视频流，检测画面中的人脸，并与预先注册的员工/学生人脸数据库进行比对，完成身份验证和自动记录考勤。

该项目不仅是一个功能性的应用，更是一个端到端的AI实践案例，涵盖了从硬件选型、软件环境搭建、数据准备、模型训练与优化，到最终在边缘设备上部署的全过程。

## 2. 内容大纲

### 2.1. 硬件准备

- **核心计算单元**: 昇腾310B开发者套件
- **图像采集**: USB摄像头 (推荐罗技C920或同等规格)
- **显示设备 (可选)**: HDMI显示器，用于实时预览或UI展示
- **外设**: 键盘、鼠标
- **电源**: 为昇腾310B开发板提供稳定供电
- **连接线**: HDMI线, USB-C数据线等

*附：硬件连接示意图*
> (此处可插入一张图片，清晰展示所有硬件的连接方式)

### 2.2. 软件环境

- **操作系统**: Ubuntu 20.04 或 openEuler
- **CANN版本**: 7.0或更高
- **Python版本**: 3.8.x
- **主要依赖库**:
    - `opencv-python`: 用于图像和视频处理
    - `numpy`: 用于数值计算
    - `scikit-learn`: 用于评估模型性能
    - `onnxruntime`: 用于运行ONNX模型
    - `PyQt5` (可选): 用于构建图形用户界面

*附：一键安装环境脚本 (`install_env.sh`)*
```bash
# 示例脚本
sudo apt update
sudo apt install -y python3-pip python3-opencv
pip3 install numpy scikit-learn onnxruntime
# ... 其他依赖安装命令
```

### 2.3. 数据集准备

- **数据集来源**:
    1.  **公开数据集**: 如LFW (Labeled Faces in the Wild)、CASIA-WebFace等。
    2.  **自建数据集**: 推荐！使用摄像头为每位用户（员工/学生）拍摄多张、多角度、不同光照和表情的人脸照片。
- **数据组织结构**:
  ```
  datasets/
  ├── zhang_san/
  │   ├── 001.jpg
  │   ├── 002.jpg
  │   └── ...
  ├── li_si/
  │   ├── 001.jpg
  │   ├── 002.jpg
  │   └── ...
  └── ...
  ```
- **预处理脚本 (`preprocess.py`)**:
    - 人脸检测与对齐
    - 图像增强（旋转、裁剪、调整亮度等）
    - 划分训练集和验证集

### 2.4. 模型训练

- **模型选择**:
    - **人脸检测**: MTCNN 或 RetinaFace
    - **人脸识别**: ArcFace, CosFace, 或 MobileFaceNet (推荐，因其轻量高效)
- **训练流程**:
    1.  使用预处理好的数据集进行模型训练。
    2.  调整超参数（学习率、批大小等）以获得最佳性能。
    3.  在验证集上评估模型准确率、召回率等指标。
- **模型导出**: 将训练好的PyTorch或TensorFlow模型转换为昇腾亲和的ONNX格式。

### 2.5. 模型部署

- **模型转换**: 使用ATC (Ascend Tensor Compiler) 工具将ONNX模型转换为昇腾310B支持的`.om`离线模型。
  ```bash
  atc --model=./face_recognition.onnx --framework=5 --output=./face_recognition --input_format=NCHW --input_shape="data:1,3,112,112" --soc_version=Ascend310B1
  ```
- **部署代码 (`main.py`)**:
    1.  初始化CANN和ACL (Ascend Computing Language) 资源。
    2.  加载`.om`离线模型。
    3.  循环读取摄像头帧。
    4.  对每一帧进行人脸检测和识别推理。
    5.  将识别结果与数据库比对，输出姓名。
    6.  在画面上绘制矩形框和姓名，并记录打卡时间。

### 2.6. 3D打印结构件

为了方便地将摄像头固定在合适的位置，我们设计了专用的摄像头支架和设备保护外壳。
- **文件列表**:
    - `camera_holder.stl`: 摄像头支架模型文件
    - `device_case.stl`: 设备外壳模型文件
- **打印建议**:
    - **材料**: PLA 或 PETG
    - **层高**: 0.2mm
    - **填充率**: 20%

### 2.7. 用户手册

1.  **硬件组装**: 参照`2.1`节的连接图连接好所有硬件。
2.  **环境配置**: 运行`install_env.sh`脚本安装所有软件依赖。
3.  **人脸注册**: 运行`register_face.py`脚本，根据提示输入姓名，并拍摄多张人脸照片进行注册。
4.  **启动系统**: 运行`main.py`启动人脸识别打卡程序。
5.  **查看记录**: 打卡记录将保存在`attendance.csv`文件中。

## 3. 源代码

> (此处未来可替换为GitHub仓库链接或详细的文件树)

## 4. 效果演示

> (此处可插入系统运行时的截图或GIF动图，例如摄像头实时识别人脸的画面)
